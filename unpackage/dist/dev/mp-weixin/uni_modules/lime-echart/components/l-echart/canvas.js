"use strict";const c=require("../../../../common/vendor.js"),f=require("./utils.js"),o={};class u{constructor(){this.__events={}}on(e,s){if(!e||!s)return;const i=this.__events[e]||[];i.push(s),this.__events[e]=i}emit(e,s){if(e.constructor===Object&&(s=e,e=s&&s.type),!e)return;const i=this.__events[e];!i||!i.length||i.forEach(t=>{t.call(this,s)})}off(e,s){const i=this.__events,t=i[e];if(!(!t||!t.length)){if(!s){delete i[e];return}for(let n=0,h=t.length;n<h;n++)t[n]===s&&(t.splice(n,1),n--)}}}class m{constructor(){this.currentSrc=null,this.naturalHeight=0,this.naturalWidth=0,this.width=0,this.height=0,this.tagName="IMG"}set src(e){this.currentSrc=e,c.index.getImageInfo({src:e,success:s=>{this.naturalWidth=this.width=s.width,this.naturalHeight=this.height=s.height,this.onload()},fail:()=>{this.onerror()}})}get src(){return this.currentSrc}}class g{constructor(e,s,i){this.tagName="canvas",this.com=s,this.canvasId=i,this.ctx=e}set width(e){this.com.offscreenWidth=e}set height(e){this.com.offscreenHeight=e}get width(){return this.com.offscreenWidth||0}get height(){return this.com.offscreenHeight||0}getContext(e){return this.ctx}getImageData(){return new Promise((e,s)=>{this.com.$nextTick(()=>{c.index.canvasGetImageData({x:0,y:0,width:this.com.offscreenWidth,height:this.com.offscreenHeight,canvasId:this.canvasId,success:i=>{e(i)},fail:i=>{s(i)}},this.com)})})}}class v{constructor(e,s,i,t={}){o[s.canvasId]={ctx:e},this.canvasId=s.canvasId,this.chart=null,this.isNew=i,this.tagName="canvas",this.canvasNode=t,this.com=s,i||this._initStyle(e),this._initEvent(),this._ee=new u}getContext(e){if(e==="2d")return this.ctx}setAttribute(e,s){e==="aria-label"&&(this.com.ariaLabel=s)}setChart(e){this.chart=e}createOffscreenCanvas(e){if(!this.children){this.com.isOffscreenCanvas=!0,this.com.offscreenWidth=e.width||300,this.com.offscreenHeight=e.height||300;const s=this.com,i=this.com.offscreenCanvasId,t=c.index.createCanvasContext(i,this.com);this._initStyle(t),this.children=new g(t,s,i)}return this.children}appendChild(e){c.index.__f__("log","at uni_modules/lime-echart/components/l-echart/canvas.js:162","child",e)}dispatchEvent(e,s){return typeof e=="object"?this._ee.emit(e.type,e):this._ee.emit(e,s),!0}attachEvent(){}detachEvent(){}addEventListener(e,s){this._ee.on(e,s)}removeEventListener(e,s){this._ee.off(e,s)}_initCanvas(e,s){}_initStyle(e,s){if(["fillStyle","strokeStyle","fontSize","globalAlpha","opacity","textAlign","textBaseline","shadow","lineWidth","lineCap","lineJoin","lineDash","miterLimit"].forEach(t=>{Object.defineProperty(e,t,{set:n=>{if(t==="opacity"){e.setGlobalAlpha(n);return}(t!=="fillStyle"&&t!=="strokeStyle"||n!=="none"&&n!==null)&&e["set"+t.charAt(0).toUpperCase()+t.slice(1)](n)}})}),!this.isNew&&!s&&(e.uniDrawImage=e.drawImage,e.drawImage=(...t)=>{t[0]=t[0].src,e.uniDrawImage(...t)}),e.createRadialGradient||(e.createRadialGradient=function(){return e.createCircularGradient(...[...arguments].slice(-3))}),e.strokeText||(e.strokeText=(...t)=>{e.fillText(...t)}),!e.measureText||f.getDeviceInfo().osName=="harmonyos"){e._measureText=e.measureText;const t=n=>{let h=0;for(let a=0;a<n.length;a++)n.charCodeAt(a)>0&&n.charCodeAt(a)<128?h++:h+=2;return h};e.measureText=(n,h)=>{var l;let a=((l=e==null?void 0:e.state)==null?void 0:l.fontSize)||12;h&&(a=parseInt(h.match(/([\d\.]+)px/)[1])),a/=2;const d=a>=16?1.3:1;return{width:t(n)*a*d}}}}_initEvent(e){this.event={},[{wxName:"touchStart",ecName:"mousedown"},{wxName:"touchMove",ecName:"mousemove"},{wxName:"touchEnd",ecName:"mouseup"},{wxName:"touchEnd",ecName:"click"}].forEach(i=>{this.event[i.wxName]=t=>{const n=t.touches[0];this.chart.getZr().handler.dispatch(i.ecName,{zrX:i.wxName==="tap"?n.clientX:n.x,zrY:i.wxName==="tap"?n.clientY:n.y})}})}set width(e){this.canvasNode.width=e}set height(e){this.canvasNode.height=e}get width(){return this.canvasNode.width||0}get height(){return this.canvasNode.height||0}get ctx(){return o[this.canvasId].ctx||null}set chart(e){o[this.canvasId].chart=e}get chart(){return o[this.canvasId].chart||null}}function _(r,{x:e,y:s,wheelDelta:i}){this.dispatch(r,{zrX:e,zrY:s,zrDelta:i,preventDefault:()=>{},stopPropagation:()=>{}})}function w(r,{canvas:e,node:s}){if(r&&!r.registerPreprocessor)return c.index.__f__("warn","at uni_modules/lime-echart/components/l-echart/canvas.js:357","echarts 版本不对或未传入echarts，vue3请使用esm格式");r.registerPreprocessor(t=>{t&&t.series&&(t.series.length>0?t.series.forEach(n=>{n.progressive=0}):typeof t.series=="object"&&(t.series.progressive=0))});function i(t,n,h){let a=null;return s&&s.createImage?(a=s.createImage(),a.onload=n.bind(a),a.onerror=h.bind(a),a.src=t,a):(a=new m,a.onload=n.bind(a),a.onerror=h.bind(a),a.src=t,a)}r.setPlatformAPI&&r.setPlatformAPI({loadImage:e.setChart?i:null,createCanvas(){const t="createOffscreenCanvas";return c.index.canIUse(t)&&c.index[t]?c.index[t]({type:"2d"}):e}})}exports.Canvas=v;exports.dispatch=_;exports.setCanvasCreator=w;
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/lime-echart/components/l-echart/canvas.js.map
