"use strict";const n=require("../../../../common/vendor.js"),o=require("./canvas.js"),r=require("./utils.js"),l={name:"lime-echart",props:{type:{type:String,default:"2d"},customStyle:String,isDisableScroll:Boolean,isClickable:{type:Boolean,default:!0},enableHover:Boolean,beforeDelay:{type:Number,default:30},landscape:Boolean},data(){return{use2dCanvas:!0,ariaLabel:"图表",width:null,height:null,nodeWidth:null,nodeHeight:null,config:{},inited:!1,finished:!1,file:"",platform:"",isPC:!1,isDown:!1,isOffscreenCanvas:!1,offscreenWidth:0,offscreenHeight:0}},computed:{rootStyle(){if(this.landscape)return"transform: translate(-50%,-50%) rotate(90deg); top:50%; left:50%;"},canvasId(){return`lime-echart${this._&&this._.uid||this._uid}`},offscreenCanvasId(){return`${this.canvasId}_offscreen`},offscreenStyle(){return`width:${this.offscreenWidth}px;height: ${this.offscreenHeight}px; position: fixed; left: 99999px; background: red`},canvasStyle(){return this.rootStyle+(this.width&&this.height?"width:"+this.width+"px;height:"+this.height+"px":"")}},beforeUnmount(){this.clear(),this.dispose()},created(){const{platform:e}=r.getDeviceInfo();this.isPC=/windows/i.test(e),this.use2dCanvas=this.type==="2d"&&r.canIUseCanvas2d()},mounted(){this.$nextTick(()=>{this.$emit("finished")})},methods:{setChart(e){if(!this.chart){n.index.__f__("warn","at uni_modules/lime-echart/components/l-echart/l-echart.vue:218","组件还未初始化，请先使用 init");return}typeof e=="function"&&this.chart&&e(this.chart)},setOption(){if(!this.chart||!this.chart.setOption){n.index.__f__("warn","at uni_modules/lime-echart/components/l-echart/l-echart.vue:232","组件还未初始化，请先使用 init");return}this.chart.setOption(...arguments)},showLoading(){this.chart&&this.chart.showLoading(...arguments)},hideLoading(){this.chart&&this.chart.hideLoading()},clear(){this.chart&&this.chart.clear()},dispose(){this.chart&&this.chart.dispose()},resize(e){e&&e.width&&e.height?(this.height=e.height,this.width=e.width,this.chart&&this.chart.resize(e)):this.$nextTick(()=>{n.index.createSelectorQuery().in(this).select(".lime-echart").boundingClientRect().exec(h=>{if(h){let{width:a,height:s}=h[0];this.width=a=a||300,this.height=s=s||300,this.chart.resize({width:a,height:s})}})})},canvasToTempFilePath(e={}){const{use2dCanvas:h,canvasId:a}=this;return new Promise((s,c)=>{const t=Object.assign({canvasId:a,success:s,fail:c},e);h&&(delete t.canvasId,t.canvas=this.canvasNode),n.index.canvasToTempFilePath(t,this)})},async init(e,...h){if(h&&h.length==0&&!e){n.index.__f__("error","at uni_modules/lime-echart/components/l-echart/l-echart.vue:315","缺少参数：init(echarts, theme?:string, opts?: object, callback?: function)");return}let a=null,s={},c;Array.from(arguments).forEach(i=>{typeof i=="function"&&(c=i),["string"].includes(typeof i)&&(a=i),typeof i=="object"&&(s=i)}),this.beforeDelay&&await r.sleep(this.beforeDelay);let t=await this.getContext();o.setCanvasCreator(e,t);try{if(this.chart=e.init(t.canvas,a,Object.assign({},t,s)),typeof c=="function")c(this.chart);else return this.chart}catch(i){return n.index.__f__("error","at uni_modules/lime-echart/components/l-echart/l-echart.vue:347",i.messges),null}},getContext(){return r.getRect(`#${this.canvasId}`,{context:this,type:this.use2dCanvas?"fields":"boundingClientRect"}).then(e=>{if(e){let h=r.devicePixelRatio,{width:a,height:s,node:c}=e,t;if(this.width=a=a||300,this.height=s=s||300,c){const i=c.getContext("2d");t=new o.Canvas(i,this,!0,c),this.canvasNode=c}else{h=this.isPC?r.devicePixelRatio:1,this.rect=e,this.nodeWidth=a*h,this.nodeHeight=s*h;const i=n.index.createCanvasContext(this.canvasId,this);t=new o.Canvas(i,this,!1)}return{canvas:t,width:a,height:s,devicePixelRatio:h,node:c}}else return{}})},getRelative(e,h){let{clientX:a,clientY:s}=e;return!(a&&s)&&h&&h[0]&&(a=h[0].clientX,s=h[0].clientY),{x:a-this.rect.left,y:s-this.rect.top,wheelDelta:e.wheelDelta||0}},getTouch(e,h){const{x:a}=h&&h[0]||{},s=a?h[0]:this.getRelative(e,h);return this.landscape&&([s.x,s.y]=[s.y,this.height-s.x]),s},touchStart(e){this.isDown=!0;const h=()=>{const a=r.convertTouchesToArray(e.touches);if(this.chart){const s=this.getTouch(e,a);this.startX=s.x,this.startY=s.y,this.startT=new Date;const c=this.chart.getZr().handler;o.dispatch.call(c,"mousedown",s),o.dispatch.call(c,"mousemove",s),c.processGesture(r.wrapTouch(e),"start"),clearTimeout(this.endTimer)}};if(this.isPC){r.getRect(`#${this.canvasId}`,{context:this}).then(a=>{this.rect=a,h()});return}h()},touchMove(e){this.isPC&&this.enableHover&&!this.isDown&&(this.isDown=!0);const h=r.convertTouchesToArray(e.touches);if(this.chart&&this.isDown){const a=this.chart.getZr().handler;o.dispatch.call(a,"mousemove",this.getTouch(e,h)),a.processGesture(r.wrapTouch(e),"change")}},touchEnd(e){if(this.isDown=!1,this.chart){const h=r.convertTouchesToArray(e.changedTouches),{x:a}=h&&h[0]||{},s=(a?h[0]:this.getRelative(e,h))||{};this.landscape&&([s.x,s.y]=[s.y,this.height-s.x]);const c=this.chart.getZr().handler,t=Math.abs(s.x-this.startX)<10&&new Date-this.startT<200;o.dispatch.call(c,"mouseup",s),c.processGesture(r.wrapTouch(e),"end"),t?o.dispatch.call(c,"click",s):this.endTimer=setTimeout(()=>{o.dispatch.call(c,"mousemove",{x:999999999,y:999999999}),o.dispatch.call(c,"mouseup",{x:999999999,y:999999999})},50)}}}};function u(e,h,a,s,c,t){return n.e({a:t.canvasId},t.canvasId?n.e({b:c.use2dCanvas},c.use2dCanvas?{c:t.canvasId,d:n.s(t.canvasStyle),e:a.isDisableScroll,f:n.o((...i)=>t.touchStart&&t.touchStart(...i)),g:n.o((...i)=>t.touchMove&&t.touchMove(...i)),h:n.o((...i)=>t.touchEnd&&t.touchEnd(...i))}:{i:c.nodeWidth,j:c.nodeHeight,k:n.s(t.canvasStyle),l:t.canvasId,m:t.canvasId,n:a.isDisableScroll,o:n.o((...i)=>t.touchStart&&t.touchStart(...i)),p:n.o((...i)=>t.touchMove&&t.touchMove(...i)),q:n.o((...i)=>t.touchEnd&&t.touchEnd(...i))},{r:c.isPC},c.isPC?{s:n.o((...i)=>t.touchStart&&t.touchStart(...i)),t:n.o((...i)=>t.touchMove&&t.touchMove(...i)),v:n.o((...i)=>t.touchEnd&&t.touchEnd(...i)),w:n.o((...i)=>t.touchStart&&t.touchStart(...i)),x:n.o((...i)=>t.touchMove&&t.touchMove(...i)),y:n.o((...i)=>t.touchEnd&&t.touchEnd(...i))}:{},{z:c.isOffscreenCanvas},c.isOffscreenCanvas?{A:n.s(t.offscreenStyle),B:t.offscreenCanvasId}:{},{C:n.s(a.customStyle),D:c.ariaLabel}):{})}const d=n._export_sfc(l,[["render",u]]);wx.createComponent(d);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/lime-echart/components/l-echart/l-echart.js.map
