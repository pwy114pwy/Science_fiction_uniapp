"use strict";const e=require("../../common/vendor.js"),_=require("../../api.js");Array||e.resolveComponent("uni-icons")();const S=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||S();const P={__name:"profile",setup(v){let f=JSON.parse(e.index.getStorageSync("userInfo")),t=e.ref(f.nickname),s=e.ref(f.email),r=e.ref(""),a=e.ref(""),u=e.ref(""),o=e.ref("true"),p=f.username,l=e.ref(!0),i=e.ref(!0);function m(){o.value=!1}async function g(){o.value=!0;try{if((await e.index.request({url:_.Change_Userinfo,method:"POST",data:{username:p,new_nickname:t.value,new_email:s.value}})).statusCode==200){e.index.showToast({title:"修改成功",icon:"success",duration:2e3});const d=await e.index.request({url:_.Get_Userinfo,method:"GET",header:{Authorization:`Bearer ${e.index.getStorageSync("token")}`}});e.index.setStorageSync("userInfo",JSON.stringify(d.data.userInfo)),e.index.__f__("log","at pages/profile/profile.vue:107",d)}}catch{e.index.__f__("log","at pages/profile/profile.vue:110","请求失败")}}function w(){o.value=!0,t.value=f.nickname,s.value=f.email}async function h(){if(a.value!==u.value){e.index.showToast({title:"新密码与确认密码不一致",icon:"none",duration:2e3});return}try{const c=await e.index.request({url:_.Change_Password,method:"POST",data:{username:p,old_password:r.value,new_password:a.value},header:{Authorization:`Bearer ${e.index.getStorageSync("token")}`}});e.index.__f__("log","at pages/profile/profile.vue:145",c),c.statusCode==200?(e.index.showToast({title:"密码修改成功",icon:"success",duration:2e3}),r.value="",a.value="",u.value=""):e.index.showToast({title:"原密码错误",icon:"none",duration:2e3})}catch{e.index.showToast({title:"请求失败，请稍后再试",icon:"none",duration:2e3})}}function x(){l.value=!l.value}function y(){i.value=!i.value}return(c,d)=>e.e({a:e.unref(l)},e.unref(l)?{b:e.p({type:"down",size:"30"})}:{c:e.p({type:"up",size:"30"})},{d:e.t(e.unref(l)?"修改个人信息":"个人信息："),e:e.o(x),f:e.unref(o),g:e.unref(t),h:e.o(n=>e.isRef(t)?t.value=n.detail.value:t=n.detail.value),i:e.unref(o),j:e.unref(s),k:e.o(n=>e.isRef(s)?s.value=n.detail.value:s=n.detail.value),l:e.unref(o)},e.unref(o)?{m:e.o(m)}:{n:e.o(g),o:e.o(w)},{p:!e.unref(l),q:e.unref(i)},e.unref(i)?{r:e.p({type:"down",size:"30"})}:{s:e.p({type:"up",size:"30"})},{t:e.t(e.unref(i)?"修改密码":"修改密码："),v:e.o(y),w:e.unref(r),x:e.o(n=>e.isRef(r)?r.value=n.detail.value:r=n.detail.value),y:e.unref(a),z:e.o(n=>e.isRef(a)?a.value=n.detail.value:a=n.detail.value),A:e.unref(u),B:e.o(n=>e.isRef(u)?u.value=n.detail.value:u=n.detail.value),C:!e.unref(i),D:e.o(h),E:!e.unref(i)})}};wx.createPage(P);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/profile/profile.js.map
