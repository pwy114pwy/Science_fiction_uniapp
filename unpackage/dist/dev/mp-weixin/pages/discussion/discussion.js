"use strict";const s=require("../../common/vendor.js"),l=require("../../api.js");if(!Array){const D=s.resolveComponent("uni-icons"),t=s.resolveComponent("transition");(D+t)()}const m=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||m();const S={__name:"discussion",setup(D){let t=JSON.parse(s.index.getStorageSync("userInfo"));s.index.__f__("log","at pages/discussion/discussion.vue:58",t);let g=s.ref([]),u=s.ref(""),a=s.ref(""),f=()=>{let e=new Date,o=e.getFullYear(),i=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,_=e.getDate()<10?"0"+e.getDate():e.getDate(),c=e.getHours()<10?"0"+e.getHours():e.getHours(),n=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),d=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return o+"年"+i+"月"+_+"日"+c+":"+n+":"+d};function p(e){s.index.showModal({title:"提示",content:"您确定要删除吗？",showCancel:!0,cancelText:"取消",confirmText:"确定",success:function(o){o.confirm&&v(e)}})}async function v(e){try{const o=await s.index.request({url:l.Delete_Discussion,method:"POST",data:{Discussion_ID:e,Discussion_User_ID:t.id}});s.index.__f__("log","at pages/discussion/discussion.vue:102",o),o.statusCode==200&&(s.index.showToast({icon:"success",title:"删除成功"}),r()),s.index.__f__("log","at pages/discussion/discussion.vue:110",o)}catch(o){s.index.__f__("error","at pages/discussion/discussion.vue:112","删除评论失败:",o)}}async function r(){try{const e=await s.index.request({url:l.Get_Discussion,method:"POST",data:{Illustrated_ID:s.index.getStorageSync("NowIllustrated").Book_ID}});s.index.__f__("log","at pages/discussion/discussion.vue:127",e.data),g.value=e.data}catch(e){s.index.__f__("error","at pages/discussion/discussion.vue:130","获取评论失败:",e)}}async function I(e){if(s.index.__f__("log","at pages/discussion/discussion.vue:136",t),t&&u.value)try{(await s.index.request({url:l.Add_Discussion,method:"POST",data:{Illustrated_ID:e.Illustrated_ID,Illustrated_Name:e.Illustrated_ID,Discussion_User_ID:t.id,Discussion_User_NickName:t.nickname,Discussion_Parent_ID:e.Discussion_ID,Discussion_Content:u.value,Discussion_Time:f()}})).statusCode==200&&(s.index.showToast({icon:"success",title:"回复成功"}),u.value="",r())}catch(o){s.index.__f__("error","at pages/discussion/discussion.vue:163","添加回复失败:",o)}else s.index.__f__("log","at pages/discussion/discussion.vue:166","请先登录或填写回复内容")}async function h(){if(s.index.__f__("log","at pages/discussion/discussion.vue:172",t),t&&a.value)try{(await s.index.request({url:l.Add_Discussion,method:"POST",data:{Illustrated_ID:s.index.getStorageSync("NowIllustrated").Book_ID,Illustrated_Name:s.index.getStorageSync("NowIllustrated").Book_Name,Discussion_User_ID:t.id,Discussion_User_NickName:t.nickname,Discussion_Parent_ID:0,Discussion_Content:a.value,Discussion_Time:f()}})).statusCode==200&&(s.index.showToast({icon:"success",title:"评论成功"}),a.value="",r())}catch(e){s.index.__f__("error","at pages/discussion/discussion.vue:199","添加评论失败:",e)}else s.index.__f__("log","at pages/discussion/discussion.vue:202","请先登录或填写回复内容")}function x(e){e.showReplies=!e.showReplies}return s.onMounted(()=>{r()}),(e,o)=>({a:s.f(s.unref(g),(i,_,c)=>s.e({a:s.t(i.Discussion_User_NickName),b:s.t(i.Discussion_Time),c:i.Discussion_User_ID==s.unref(t).id},i.Discussion_User_ID==s.unref(t).id?{d:s.o(n=>p(i.Discussion_ID),_),e:"2e892073-0-"+c,f:s.p({type:"trash",size:"18"})}:{},{g:s.t(i.Discussion_Content),h:s.t(i.showReplies?"收起回复":"展开回复"),i:s.n("fa-angle-"+(i.showReplies?"up":"down")),j:s.o(n=>x(i),_),k:!i.Discussion_Parent_ID&&i.showReplies},!i.Discussion_Parent_ID&&i.showReplies?{l:s.f(i.child_discuss,(n,d,w)=>s.e({a:s.t(n.Discussion_User_NickName),b:s.t(n.Discussion_Time),c:n.Discussion_User_ID==s.unref(t).id},n.Discussion_User_ID==s.unref(t).id?{d:s.o(N=>p(n.Discussion_ID),d),e:"2e892073-2-"+c+"-"+w+","+("2e892073-1-"+c),f:s.p({type:"trash",size:"18"})}:{},{g:s.t(n.Discussion_Content),h:d})),m:s.unref(u),n:s.o(n=>s.isRef(u)?u.value=n.detail.value:u=n.detail.value,_),o:s.o(n=>I(i),_)}:{},{p:"2e892073-1-"+c,q:_})),b:s.p({name:"fade"}),c:s.unref(a),d:s.o(i=>s.isRef(a)?a.value=i.detail.value:a=i.detail.value),e:s.o(i=>h(e.comment))})}},y=s._export_sfc(S,[["__scopeId","data-v-2e892073"]]);wx.createPage(y);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/discussion/discussion.js.map
