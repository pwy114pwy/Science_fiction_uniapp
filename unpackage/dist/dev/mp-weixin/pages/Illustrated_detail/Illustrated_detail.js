"use strict";const e=require("../../common/vendor.js"),g=require("../../api.js");if(!Array){const h=e.resolveComponent("uni-icons"),s=e.resolveComponent("l-echart");(h+s)()}const P=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",q=()=>"../../uni_modules/lime-echart/components/l-echart/l-echart.js";Math||(P+q)();const T={__name:"Illustrated_detail",setup(h){const s=e.ref(null),v=e.ref(null);let p=e.index.getStorageSync("NowIllustrated");const f=e.ref([]),m=e.ref([]),l=e.ref([]),c=e.ref(!1),y=e.ref({}),u=e.ref(!1),d=e.ref(!1);e.onMounted(async()=>{try{const a=await e.index.request({url:g.Get_Worldview,method:"POST",data:{Illustrated_ID:e.index.getStorageSync("NowIllustrated").Book_ID}});f.value=a.data,m.value=f.value.map(t=>({Worldview_Title:t.Worldview_Title,Worldview_Description:t.Worldview_Description.slice(0,50)+(t.Worldview_Description.length>50?"...":""),fullDescription:t.Worldview_Description})),e.index.__f__("log","at pages/Illustrated_detail/Illustrated_detail.vue:122",m.value),l.value=a.data.map(()=>!1),e.index.__f__("log","at pages/Illustrated_detail/Illustrated_detail.vue:124",a);const I=await e.index.request({url:g.Get_CharactersAndRelationships,method:"POST",data:{Illustrated_ID:e.index.getStorageSync("NowIllustrated").Book_ID}}),n={title:{text:"人物关系网"},tooltip:{},animationDurationUpdate:1500,animationEasingUpdate:"quinticInOut",series:[{type:"graph",layout:"none",symbolSize:40,label:{show:!0},edgeLabel:{fontSize:15},data:[],links:[],lineStyle:{opacity:.9,width:2,curveness:0}}]},{characters:o,relationships:b}=I.data;n.series[0].data=o.map(t=>({c_id:t.id,name:t.name,x:t.x,y:t.y})),n.series[0].links=b.map(t=>({source:t.from,target:t.to,label:{show:!0,formatter:t.label},lineStyle:{curveness:.2}})),setTimeout(async()=>{if(!s.value)return;const t=await s.value.init(e.echarts);t.setOption(n),t.on("click",async function(i){if(i.seriesType==="graph"&&i.dataType==="node"){const _=i.data.c_id;e.index.navigateTo({url:`/pages/character_detail/character_detail?id=${_}`})}})},300);const r=await e.index.request({url:g.Get_Event,method:"POST",data:{Illustrated_ID:e.index.getStorageSync("NowIllustrated").Book_ID}}),W={tooltip:{trigger:"axis",axisPointer:{type:"line"}},toolbox:{feature:{saveAsImage:{}}},legend:{data:["事件"]},xAxis:{type:"category",boundaryGap:!1,data:r.data.map(t=>t.Event_Time),axisLabel:{rotate:45,interval:0}},yAxis:{type:"value",name:"重要性评分",min:0,max:10,splitLine:{show:!1}},series:[{name:"事件",type:"line",symbol:"circle",symbolSize:function(t){return t[1]*5},data:r.data.map(t=>[t.Event_Time,t.Event_Value]),itemStyle:{color:"#ff7f50"},markPoint:{data:r.data.filter(t=>t.Event_Value>7).map(t=>({coord:[t.Event_Time,t.Event_Value],value:t.Event_Description}))}}],dataZoom:[{type:"slider",xAxisIndex:0,filterMode:"empty",start:0,end:100},{type:"inside",xAxisIndex:0,start:0,end:100}],grid:{bottom:90}};setTimeout(async()=>{if(!v.value)return;const t=await v.value.init(e.echarts);t.setOption(W),t.on("click",function(i){if(i.seriesType==="line"){const _=r.data.find(O=>O.Event_Time===i.name);_&&e.index.showToast({title:`${_.Event_Description}`,icon:"none",duration:5e3})}})},300)}catch(a){e.index.__f__("error","at pages/Illustrated_detail/Illustrated_detail.vue:299","Error fetching data:",a)}});function w(){u.value=!u.value,d.value=!1}function x(){d.value=!d.value,u.value=!1}function D(){e.index.navigateTo({url:`/pages/science_rate/science_rate?id=${p.Book_ID}`})}function S(){e.index.navigateTo({url:`/pages/discussion/discussion?id=${p.Book_ID}`})}function k(a){l.value[a]?l.value[a]=!1:(y.value=f.value[a],c.value=!0)}function E(){c.value=!1}return e.onLoad(a=>{JSON.parse(a.id)}),(a,I)=>e.e({a:e.t(e.unref(p).Book_Name),b:e.f(m.value,(n,o,b)=>({a:e.t(n.Worldview_Title),b:e.t(n.Worldview_Description),c:l.value[o]?"":1,d:e.t(l.value[o]?"收起":"展开"),e:e.o(r=>k(o),o),f:o})),c:e.o(w),d:e.o(x),e:e.o(D),f:e.o(S),g:e.o(w),h:e.p({type:"closeempty",size:"30"}),i:e.sr(s,"2e1598b6-1",{k:"chartRef"}),j:u.value,k:e.o(x),l:e.p({type:"closeempty",size:"30"}),m:e.sr(v,"2e1598b6-3",{k:"timelineChartRef"}),n:d.value,o:c.value},c.value?{p:e.t(y.value.Worldview_Title),q:e.o(E),r:e.t(y.value.Worldview_Description)}:{})}},A=e._export_sfc(T,[["__scopeId","data-v-2e1598b6"]]);T.__runtimeHooks=2;wx.createPage(A);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/Illustrated_detail/Illustrated_detail.js.map
