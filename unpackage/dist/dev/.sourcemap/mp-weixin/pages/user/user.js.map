{"version":3,"file":"user.js","sources":["pages/user/user.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci91c2VyLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"user-center\">\r\n\t\t<!-- 用户信息区域 -->\r\n\t\t<view class=\"user-info\">\r\n\t\t\t\r\n\t\t\t<image :src=\"userInfo.avatarUrl\" class=\"avatar\" @click=\"chooseAvatar\"></image>\r\n\t\t\t<view class=\"user-details\">\r\n\t\t\t\t<p class=\"username\">{{ userInfo.nickname }}</p>\r\n\t\t\t\t<button v-if=\"!isLoggedIn\" @click=\"handleLogin\">登录/注册</button>\r\n\t\t\t\t<button v-else @click=\"logout\">退出登录</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 功能列表 -->\r\n\t\t<view class=\"function-list\">\r\n\t\t\t<view class=\"function-item\" @click=\"navigateTo('history')\">\r\n\t\t\t\t<text>浏览历史</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"function-item\" @click=\"navigateTo('collect')\">\r\n\t\t\t\t<text>我的收藏</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"function-item\" @click=\"navigateTo('profile')\">\r\n\t\t\t\t<text>个人资料</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tonMounted\r\n\t} from 'vue';\r\n\timport { User_Avatar,Get_Userinfo } from '@/api'; // 假设这里是你处理用户相关请求的API\r\n\r\n\tlet isLoggedIn = ref(false);\r\n\tlet userInfo = ref({\r\n\t\tavatarUrl: \"\",\r\n\t\temail: \"\",\r\n\t\tid: 0,\r\n\t\tnickname: \"\",\r\n\t    username: \"\",\r\n\t});\r\n\r\n\tconst handleLogin = () => {\r\n\t\t// 这里可以跳转到登录或注册页面\r\n\t\tuni.navigateTo({\r\n\t\t\turl: '/pages/login/login'\r\n\t\t});\r\n\t};\r\n\r\n\tconst chooseAvatar = async () => {\r\n\t  if (!isLoggedIn.value) {\r\n\t    uni.showToast({\r\n\t      title: '请先登录',\r\n\t      icon: 'none'\r\n\t    });\r\n\t    return;\r\n\t  }\r\n\t  const res = await uni.chooseImage({\r\n\t    count: 1,\r\n\t    sizeType: ['compressed'],\r\n\t    sourceType: ['album', 'camera']\r\n\t  });\r\n\t  if (res.tempFilePaths.length > 0) {\r\n\t    // 上传图片到服务器并更新用户头像\r\n\t    updateUserAvatar(res.tempFilePaths[0]);\r\n\t  }\r\n\t};\r\n\t\r\n\tconst updateUserAvatar = async (filePath) => {\r\n\t  // 调用API更新用户头像\r\n\t  const result = await uni.uploadFile({\r\n\t    url: User_Avatar,\r\n\t    filePath: filePath,\r\n\t    name: 'file',\r\n\t    header: {\r\n\t      Authorization: `Bearer ${uni.getStorageSync('token')}`\r\n\t    }\r\n\t  });\r\n\t  if (result.statusCode === 200) {\r\n\t    const data = JSON.parse(result.data);\r\n\t    if (data.success) {\r\n\t      userInfo.value.avatarUrl = data.avatarUrl;\r\n\t      uni.showToast({\r\n\t        title: '头像更新成功',\r\n\t        icon: 'success'\r\n\t      });\r\n\t    } else {\r\n\t      uni.showToast({\r\n\t        title: '头像更新失败',\r\n\t        icon: 'none'\r\n\t      });\r\n\t    }\r\n\t  } else {\r\n\t    uni.showToast({\r\n\t      title: '网络请求失败，请检查您的网络连接',\r\n\t      icon: 'none'\r\n\t    });\r\n\t  }\r\n\t};\r\n\r\n\tconst logout = async () => {\r\n\t\t// await uni.request({\r\n\t\t// \turl: `http://127.0.0.1:3000/api/user/logout`,\r\n\t\t// \tmethod: 'POST',\r\n\t\t// \theader: {\r\n\t\t// \t\tAuthorization: `Bearer ${uni.getStorageSync('token')}`\r\n\t\t// \t}\r\n\t\t// });\r\n\t\tuni.removeStorageSync(\"token\")\r\n\t\tuni.removeStorageSync(\"userInfo\")\r\n\t\tisLoggedIn.value = false;\r\n\t\tuserInfo.value = {};\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '退出成功',\r\n\t\t\tduration: 2000\r\n\t\t});\r\n\t};\r\n\r\n\tconst navigateTo = (page) => {\r\n\t\tif (!isLoggedIn.value) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请先登录',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tuni.navigateTo({\r\n\t\t\turl: `/pages/${page}/${page}`\r\n\t\t});\r\n\t};\r\n\r\n\tonMounted(async () => {\r\n\t\t// 页面加载时尝试获取用户信息\r\n\t\tconst user = await uni.request({\r\n\t\t\turl: Get_Userinfo,\r\n\t\t\tmethod: 'GET',\r\n\t\t\theader: {\r\n\t\t\t\tAuthorization: `Bearer ${uni.getStorageSync('token')}`\r\n\t\t\t}\r\n\t\t});\r\n\t\tconsole.log(user);\r\n\t\tif (user.statusCode == 200) {\r\n\t\t\tisLoggedIn.value = true;\r\n\t\t\tuserInfo.value = user.data.userInfo;\r\n\t\t}\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t.user-center {\r\n\t\tpadding: 20px;\r\n\t}\r\n\r\n\t.user-info {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n\r\n\t.avatar {\r\n\t\twidth: 60px;\r\n\t\theight: 60px;\r\n\t\tborder-radius: 50%;\r\n\t\tmargin-right: 15px;\r\n\t}\r\n\r\n\t.user-details {\r\n\t\tflex: 1;\r\n\t}\r\n\r\n\t.function-list {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t.function-item {\r\n\t\tpadding: 10px 0;\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t}\r\n\r\n\t.function-item:last-child {\r\n\t\tborder-bottom: none;\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/uniapp工作空间/Science _fiction/pages/user/user.vue'\nwx.createPage(MiniProgramPage)"],"names":["isLoggedIn","ref","userInfo","handleLogin","uni","chooseAvatar","res","updateUserAvatar","filePath","result","User_Avatar","data","logout","navigateTo","page","onMounted","user","Get_Userinfo","MiniProgramPage"],"mappings":"2GAmCC,IAAIA,EAAaC,MAAI,EAAK,EACtBC,EAAWD,EAAAA,IAAI,CAClB,UAAW,GACX,MAAO,GACP,GAAI,EACJ,SAAU,GACP,SAAU,EACf,CAAE,EAED,MAAME,EAAc,IAAM,CAEzBC,EAAAA,MAAI,WAAW,CACd,IAAK,oBACR,CAAG,CACH,EAEOC,EAAe,SAAY,CAC/B,GAAI,CAACL,EAAW,MAAO,CACrBI,EAAAA,MAAI,UAAU,CACZ,MAAO,OACP,KAAM,MACb,CAAM,EACD,MACD,CACD,MAAME,EAAM,MAAMF,EAAG,MAAC,YAAY,CAChC,MAAO,EACP,SAAU,CAAC,YAAY,EACvB,WAAY,CAAC,QAAS,QAAQ,CACnC,CAAI,EACGE,EAAI,cAAc,OAAS,GAE7BC,EAAiBD,EAAI,cAAc,CAAC,CAAC,CAE1C,EAEOC,EAAmB,MAAOC,GAAa,CAE3C,MAAMC,EAAS,MAAML,EAAG,MAAC,WAAW,CAClC,IAAKM,EAAW,YAChB,SAAUF,EACV,KAAM,OACN,OAAQ,CACN,cAAe,UAAUJ,EAAAA,MAAI,eAAe,OAAO,CAAC,EACrD,CACN,CAAI,EACD,GAAIK,EAAO,aAAe,IAAK,CAC7B,MAAME,EAAO,KAAK,MAAMF,EAAO,IAAI,EAC/BE,EAAK,SACPT,EAAS,MAAM,UAAYS,EAAK,UAChCP,EAAAA,MAAI,UAAU,CACZ,MAAO,SACP,KAAM,SACf,CAAQ,GAEDA,EAAAA,MAAI,UAAU,CACZ,MAAO,SACP,KAAM,MACf,CAAQ,CAER,MACKA,EAAAA,MAAI,UAAU,CACZ,MAAO,mBACP,KAAM,MACb,CAAM,CAEN,EAEOQ,EAAS,SAAY,CAQ1BR,EAAG,MAAC,kBAAkB,OAAO,EAC7BA,EAAG,MAAC,kBAAkB,UAAU,EAChCJ,EAAW,MAAQ,GACnBE,EAAS,MAAQ,GACjBE,EAAAA,MAAI,UAAU,CACb,MAAO,OACP,SAAU,GACb,CAAG,CACH,EAEOS,EAAcC,GAAS,CAC5B,GAAI,CAACd,EAAW,MAAO,CACtBI,EAAAA,MAAI,UAAU,CACb,MAAO,OACP,KAAM,MACV,CAAI,EACD,MACA,CACDA,EAAAA,MAAI,WAAW,CACd,IAAK,UAAUU,CAAI,IAAIA,CAAI,EAC9B,CAAG,CACH,EAECC,OAAAA,EAAAA,UAAU,SAAY,CAErB,MAAMC,EAAO,MAAMZ,EAAG,MAAC,QAAQ,CAC9B,IAAKa,EAAY,aACjB,OAAQ,MACR,OAAQ,CACP,cAAe,UAAUb,EAAAA,MAAI,eAAe,OAAO,CAAC,EACpD,CACJ,CAAG,EACDA,EAAAA,+CAAYY,CAAI,EACZA,EAAK,YAAc,MACtBhB,EAAW,MAAQ,GACnBE,EAAS,MAAQc,EAAK,KAAK,SAE9B,CAAE,wPClJF,GAAG,WAAWE,CAAe"}