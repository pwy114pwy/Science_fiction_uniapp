{"version":3,"file":"history.js","sources":["pages/history/history.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaGlzdG9yeS9oaXN0b3J5LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"collect-page\">\r\n\t\t<view v-if=\"loading\" class=\"loading\">\r\n\t\t\t<text>加载中...</text>\r\n\t\t</view>\r\n\t\t<view v-else-if=\"history.length === 0\" class=\"empty\">\r\n\t\t\t<text>暂无历史记录</text>\r\n\t\t</view>\r\n\t\t<view v-else class=\"history\">\r\n\t\t\t<button @click=\"clearAllHistory\" class=\"clear-btn\">清空所有记录</button>\r\n\t\t\t<view class=\"history-list\">\r\n\t\t\t\t<view v-for=\"item in history\" :key=\"item.Book_ID\" class=\"history-item\">\r\n\t\t\t\t\t<view class=\"cover\" @click=\"viewItem(item.Book_ID)\">\r\n\t\t\t\t\t\t<image :src=\"item.Img_Url\" class=\"cover-image\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"info\">\r\n\t\t\t\t\t\t<p><text class=\"book-name\">{{ item.Book_Name }}</text></p>\r\n\t\t\t\t\t\t<text class=\"browse-time\">{{ item.Browse_Time }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"action\">\r\n\t\t\t\t\t\t<button @click=\"removeFromHistory(item.Book_ID)\" class=\"delete-btn\">删除记录</button>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tonMounted\r\n\t} from 'vue';\r\n\timport {\r\n\t\tGet_All_BrowseHistory,\r\n\t\tDelete_BrowseHistory,\r\n\t\tClear_AllBrowseHistory\r\n\t} from \"@/api\"\r\n\tconst loading = ref(true);\r\n\tconst history = ref([]);\r\n\tconst user = JSON.parse(uni.getStorageSync('userInfo'));\r\n\r\n\tconst fetchBrowse = async () => {\r\n\t\ttry {\r\n\t\t\tconst response = await uni.request({\r\n\t\t\t\turl: Get_All_BrowseHistory,\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tUser_Name: user.username,\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\thistory.value = response.data;\r\n\t\t\tconsole.log(history.value);\r\n\t\t} catch (error) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '加载失败，请稍后再试',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t} finally {\r\n\t\t\tloading.value = false;\r\n\t\t}\r\n\t};\r\n\r\n\tconst viewItem = (id) => {\r\n\t\t// 这里可以根据id导航到详细页面\r\n\t\tuni.navigateTo({\r\n\t\t\turl: `/pages/detail/detail?id=${id}`\r\n\t\t});\r\n\t};\r\n\r\n\tconst removeFromHistory = async (bookId) => {\r\n\t\ttry {\r\n\t\t\tconst response = await uni.request({\r\n\t\t\t\turl: Delete_BrowseHistory,\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tUser_Name: user.username,\r\n\t\t\t\t\tBook_ID: bookId\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconsole.log(response);\r\n\t\t\tif (response.statusCode == 200) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '删除记录成功',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t});\r\n\t\t\t\t// 更新本地数据\r\n\t\t\t\thistory.value = history.value.filter(item => item.Book_ID !== bookId);\r\n\t\t\t} else {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '删除记录失败，请稍后再试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '网络请求失败，请检查您的网络连接',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tconst clearAllHistory = async () => {\r\n\t\ttry {\r\n\t\t\tconst response = await uni.request({\r\n\t\t\t\turl: Clear_AllBrowseHistory,\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tUser_Name: user.username\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconsole.log(response);\r\n\t\t\tif (response.statusCode == 200) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '清空记录成功',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t});\r\n\t\t\t\t// 清空本地数据\r\n\t\t\t\thistory.value = [];\r\n\t\t\t} else {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '清空记录失败，请稍后再试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '网络请求失败，请检查您的网络连接',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tfetchBrowse();\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t.collect-page {\r\n\t\tpadding: 20px;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tfont-family: 'Arial', sans-serif;\r\n\t}\r\n\r\n\t.loading,\r\n\t.empty {\r\n\t\ttext-align: center;\r\n\t\tpadding: 20px;\r\n\t\tcolor: #999;\r\n\t\tfont-size: 16px;\r\n\t}\r\n\r\n\t.history-list {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: 20px;\r\n\t\tmargin-top: 20px;\r\n\t}\r\n\r\n\t.history-item {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tbackground-color: #fff;\r\n\t\tpadding: 15px;\r\n\t\tborder-radius: 10px;\r\n\t\tbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\r\n\t\ttransition: transform 0.2s;\r\n\t}\r\n\r\n\t.history-item:hover {\r\n\t\ttransform: translateY(-5px);\r\n\t}\r\n\r\n\t.cover {\r\n\t\tflex: 1;\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\t.cover-image {\r\n\t\twidth: 60px;\r\n\t\theight: 90px;\r\n\t\tborder-radius: 5px;\r\n\t\tobject-fit: cover;\r\n\t}\r\n\r\n\t.info {\r\n\t\tflex: 2;\r\n\t\tpadding-left: 10px;\r\n\t}\r\n\r\n\t.book-name {\r\n\t\tfont-size: 18px;\r\n\t\tcolor: #333;\r\n\t\tfont-weight: bold;\r\n\t\tmargin: 0;\r\n\t}\r\n\r\n\t.browse-time {\r\n\t\tfont-size: 14px;\r\n\t\tcolor: #666;\r\n\t\tmargin-top: 5px;\r\n\t}\r\n\r\n\t.action {\r\n\t\tflex: 1;\r\n\t\ttext-align: right;\r\n\t}\r\n\r\n\t.delete-btn {\r\n\t\tbackground-color: #ff4d4f;\r\n\t\tcolor: white;\r\n\t\tborder: none;\r\n\t\tpadding: 8px 15px;\r\n\t\tborder-radius: 5px;\r\n\t\tcursor: pointer;\r\n\t\tfont-size: 14px;\r\n\t\ttransition: background-color 0.3s;\r\n\t\tbox-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.delete-btn:hover {\r\n\t\tbackground-color: #e53935;\r\n\t\tbox-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.clear-btn {\r\n\t\tbackground-color: #ff9800;\r\n\t\tcolor: white;\r\n\t\tborder: none;\r\n\t\tpadding: 10px 20px;\r\n\t\tborder-radius: 5px;\r\n\t\tcursor: pointer;\r\n\t\tfont-size: 16px;\r\n\t\tmargin-bottom: 20px;\r\n\t\ttransition: background-color 0.3s;\r\n\t}\r\n\r\n\t.clear-btn:hover {\r\n\t\tbackground-color: #e68a00;\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/uniapp工作空间/Science _fiction/pages/history/history.vue'\nwx.createPage(MiniProgramPage)"],"names":["loading","ref","history","user","uni","fetchBrowse","response","Get_All_BrowseHistory","viewItem","id","removeFromHistory","bookId","Delete_BrowseHistory","item","clearAllHistory","Clear_AllBrowseHistory","onMounted","MiniProgramPage"],"mappings":"8GAsCC,MAAMA,EAAUC,MAAI,EAAI,EAClBC,EAAUD,MAAI,CAAA,CAAE,EAChBE,EAAO,KAAK,MAAMC,EAAG,MAAC,eAAe,UAAU,CAAC,EAEhDC,EAAc,SAAY,CAC/B,GAAI,CACH,MAAMC,EAAW,MAAMF,EAAG,MAAC,QAAQ,CAClC,IAAKG,EAAqB,sBAC1B,OAAQ,OACR,KAAM,CACL,UAAWJ,EAAK,QAChB,CACL,CAAI,EACDD,EAAQ,MAAQI,EAAS,KACzBF,EAAA,MAAA,MAAA,MAAA,kCAAYF,EAAQ,KAAK,CACzB,MAAe,CACfE,EAAAA,MAAI,UAAU,CACb,MAAO,aACP,KAAM,MACV,CAAI,CACJ,QAAY,CACTJ,EAAQ,MAAQ,EAChB,CACH,EAEOQ,EAAYC,GAAO,CAExBL,EAAAA,MAAI,WAAW,CACd,IAAK,2BAA2BK,CAAE,EACrC,CAAG,CACH,EAEOC,EAAoB,MAAOC,GAAW,CAC3C,GAAI,CACH,MAAML,EAAW,MAAMF,EAAG,MAAC,QAAQ,CAClC,IAAKQ,EAAoB,qBACzB,OAAQ,OACR,KAAM,CACL,UAAWT,EAAK,SAChB,QAASQ,CACT,CACL,CAAI,EACDP,EAAAA,MAAY,MAAA,MAAA,kCAAAE,CAAQ,EAChBA,EAAS,YAAc,KAC1BF,EAAAA,MAAI,UAAU,CACb,MAAO,SACP,KAAM,SACX,CAAK,EAEDF,EAAQ,MAAQA,EAAQ,MAAM,OAAOW,GAAQA,EAAK,UAAYF,CAAM,GAEpEP,EAAAA,MAAI,UAAU,CACb,MAAO,eACP,KAAM,MACX,CAAK,CAEF,MAAe,CACfA,EAAAA,MAAI,UAAU,CACb,MAAO,mBACP,KAAM,MACV,CAAI,CACD,CACH,EAEOU,EAAkB,SAAY,CACnC,GAAI,CACH,MAAMR,EAAW,MAAMF,EAAG,MAAC,QAAQ,CAClC,IAAKW,EAAsB,uBAC3B,OAAQ,OACR,KAAM,CACL,UAAWZ,EAAK,QAChB,CACL,CAAI,EACDC,EAAAA,MAAY,MAAA,MAAA,mCAAAE,CAAQ,EAChBA,EAAS,YAAc,KAC1BF,EAAAA,MAAI,UAAU,CACb,MAAO,SACP,KAAM,SACX,CAAK,EAEDF,EAAQ,MAAQ,IAEhBE,EAAAA,MAAI,UAAU,CACb,MAAO,eACP,KAAM,MACX,CAAK,CAEF,MAAe,CACfA,EAAAA,MAAI,UAAU,CACb,MAAO,mBACP,KAAM,MACV,CAAI,CACD,CACH,EAECY,OAAAA,EAAAA,UAAU,IAAM,CACfX,GACF,CAAE,kTCtIF,GAAG,WAAWY,CAAe"}