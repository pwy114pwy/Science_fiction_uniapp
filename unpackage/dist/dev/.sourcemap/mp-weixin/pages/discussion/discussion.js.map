{"version":3,"file":"discussion.js","sources":["pages/discussion/discussion.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGlzY3Vzc2lvbi9kaXNjdXNzaW9uLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<div class=\"comment-section\">\n\t\t\t<div v-for=\"(comment, index) in comments\" :key=\"index\" class=\"comment-item\">\n\t\t\t\t<div class=\"comment-header\">\n\t\t\t\t\t<span class=\"comment-author\">{{ comment.Discussion_User_NickName }}</span>\n\t\t\t\t\t<span class=\"comment-time\">{{ comment.Discussion_Time }}</span>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 删除评论 -->\n\t\t\t\t\t<uni-icons v-if=\"comment.Discussion_User_ID==user.id\" @click=\"deleteCommentStart(comment.Discussion_ID)\" type=\"trash\" size=\"18\" class=\"delete-icon\"></uni-icons>\n\t\t\t\t</div>\n\t\t\t\t<p class=\"comment-content\">{{ comment.Discussion_Content }}</p>\n\t\t\t\t<button @click=\"toggleReplies(comment)\" class=\"toggle-replies-button\">\n\t\t\t\t\t{{ comment.showReplies ? '收起回复' : '展开回复'}}\n\t\t\t\t\t<i :class=\"['fas', 'fa-angle-' + (comment.showReplies ? 'up' : 'down')]\" />\n\t\t\t\t</button>\n\t\t\t\t<transition name=\"fade\">\n\t\t\t\t\t<div v-if=\"!comment.Discussion_Parent_ID && comment.showReplies\" class=\"replies\">\n\t\t\t\t\t\t<div v-for=\"(reply, replyIndex) in comment.child_discuss\" :key=\"replyIndex\"\n\t\t\t\t\t\t\tclass=\"comment-reply\">\n\t\t\t\t\t\t\t<view class=\"reply-header\">\n\t\t\t\t\t\t\t\t<span class=\"comment-author\">{{ reply.Discussion_User_NickName }}</span>\n\t\t\t\t\t\t\t\t<span class=\"comment-time\">{{ reply.Discussion_Time }}</span>\n\t\t\t\t\t\t\t\t<!-- 删除评论 -->\n\t\t\t\t\t\t\t\t<uni-icons v-if=\"reply.Discussion_User_ID==user.id\" @click=\"deleteCommentStart(reply.Discussion_ID)\" type=\"trash\" size=\"18\" class=\"delete-icon\"></uni-icons>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<p class=\"comment-content\">{{ reply.Discussion_Content }}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<input type=\"text\" v-model=\"comment_val\" placeholder=\"请输入回复内容\" class=\"input-field\" />\n\t\t\t\t\t\t<button @click=\"addReply(comment)\" class=\"submit-button\">发表回复</button>\n\t\t\t\t\t</div>\n\t\t\t\t</transition>\n\t\t\t</div>\n\t\t</div>\n\t</view>\n\t<view class=\"bottom-ipt\">\n\t\t<input type=\"text\" v-model=\"comment_bottom_val\" placeholder=\"请输入评论内容\" class=\"\" style=\"width: 280px;\"/>\n\t\t<button @click=\"addReply_bottom(comment)\" class=\"\" style=\" width: 100px;height: 50px;display: flex;align-items: center;justify-content: center;\">发表评论</button>\n\t</view>\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tonMounted\r\n\t} from 'vue';\r\n\timport {\r\n\t\tGet_Discussion,\r\n\t\tAdd_Discussion,\r\n\t\tDelete_Discussion\r\n\t} from '@/api'\r\n\timport {\r\n\t\tuse\r\n\t} from 'echarts';\r\n\t// import uniRequest from '@dcloudio/uni-request';\r\n\r\n\tlet user = JSON.parse(uni.getStorageSync(\"userInfo\")); // 当前用户信息\r\n\tconsole.log(user);\r\n\tlet comments = ref([]);\r\n\tlet comment_val = ref(\"\")\r\n\tlet comment_bottom_val = ref(\"\")\r\n\r\n\t//获取当前时间\r\n\tlet gettime = () => {\r\n\t\tlet date = new Date();\r\n\t\tlet year = date.getFullYear();\r\n\t\tlet month = date.getMonth() + 1 < 10 ? \"0\" + (date.getMonth() + 1) : date.getMonth() + 1;\r\n\t\tlet day = date.getDate() < 10 ? \"0\" + date.getDate() : date.getDate();\r\n\t\tlet hours = date.getHours() < 10 ? \"0\" + date.getHours() : date.getHours();\r\n\t\tlet minutes = date.getMinutes() < 10 ? \"0\" + date.getMinutes() : date.getMinutes();\r\n\t\tlet seconds = date.getSeconds() < 10 ? \"0\" + date.getSeconds() : date.getSeconds();\r\n\t\treturn year + \"年\" + month + \"月\" + day + \"日\" + hours + \":\" + minutes + \":\" + seconds;\r\n\t}\r\n\t\r\n\t//删除评论\r\n\tfunction deleteCommentStart(Discussion_ID) {\r\n\t\tuni.showModal({\r\n\t\t\ttitle: '提示',\r\n\t\t\tcontent: '您确定要删除吗？',\r\n\t\t\tshowCancel: true,\r\n\t\t\tcancelText: '取消',\r\n\t\t\tconfirmText: '确定',\r\n\t\t\tsuccess: function(res) {\r\n\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\tdeletecomment(Discussion_ID)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t//删除评论\r\n\tasync function deletecomment(Discussion_ID){\r\n\t\ttry {\r\n\t\t\tconst response3 = await uni.request({\r\n\t\t\t\turl: Delete_Discussion,\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tDiscussion_ID: Discussion_ID,\r\n\t\t\t\t\tDiscussion_User_ID:user.id\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconsole.log(response3);\r\n\t\t\tif(response3.statusCode==200){\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ticon:\"success\",\r\n\t\t\t\t\ttitle:\"删除成功\"\r\n\t\t\t\t})\r\n\t\t\t\tfetchComments()\r\n\t\t\t}\r\n\t\t\tconsole.log(response3);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('删除评论失败:', error);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// 获取评论列表\r\n\tasync function fetchComments() {\r\n\t\ttry {\r\n\t\t\tconst response = await uni.request({\r\n\t\t\t\turl: Get_Discussion,\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tIllustrated_ID: uni.getStorageSync('NowIllustrated').Book_ID,\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconsole.log(response.data);\r\n\t\t\tcomments.value = response.data\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('获取评论失败:', error);\r\n\t\t}\r\n\t}\r\n\r\n\t// 添加回复\r\n\tasync function addReply(comment) {\r\n\t\tconsole.log(user);\r\n\t\tif (user && comment_val.value) {\r\n\t\t\ttry {\r\n\t\t\t\t// console.log(comment.Discussion_Parent_ID);\r\n\t\t\t\t\tconst response1 = await uni.request({\r\n\t\t\t\t\t\turl: Add_Discussion,\r\n\t\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\"Illustrated_ID\": comment.Illustrated_ID,\r\n\t\t\t\t\t\t\t\"Illustrated_Name\": comment.Illustrated_ID,\r\n\t\t\t\t\t\t\t\"Discussion_User_ID\": user.id,\r\n\t\t\t\t\t\t\t\"Discussion_User_NickName\": user.nickname,\r\n\t\t\t\t\t\t\t\"Discussion_Parent_ID\": comment.Discussion_ID,\r\n\t\t\t\t\t\t\t\"Discussion_Content\": comment_val.value,\r\n\t\t\t\t\t\t\t\"Discussion_Time\": gettime()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif(response1.statusCode==200){\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ticon:\"success\",\r\n\t\t\t\t\t\t\ttitle:\"回复成功\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tcomment_val.value=\"\"\r\n\t\t\t\t\t\tfetchComments()\r\n\t\t\t\t\t}\r\n\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('添加回复失败:', error);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.log('请先登录或填写回复内容');\r\n\t\t}\r\n\t}\r\n\r\n\t// 添加底部回复\r\n\tasync function addReply_bottom() {\r\n\t\tconsole.log(user);\r\n\t\tif (user && comment_bottom_val.value) {\r\n\t\t\ttry {\r\n\t\t\t\t// console.log(comment.Discussion_Parent_ID);\r\n\t\t\t\t\tconst response2 = await uni.request({\r\n\t\t\t\t\t\turl: Add_Discussion,\r\n\t\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\"Illustrated_ID\": uni.getStorageSync('NowIllustrated').Book_ID,\r\n\t\t\t\t\t\t\t\"Illustrated_Name\": uni.getStorageSync('NowIllustrated').Book_Name,\r\n\t\t\t\t\t\t\t\"Discussion_User_ID\": user.id,\r\n\t\t\t\t\t\t\t\"Discussion_User_NickName\": user.nickname,\r\n\t\t\t\t\t\t\t\"Discussion_Parent_ID\": 0,\r\n\t\t\t\t\t\t\t\"Discussion_Content\": comment_bottom_val.value,\r\n\t\t\t\t\t\t\t\"Discussion_Time\": gettime()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif(response2.statusCode==200){\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ticon:\"success\",\r\n\t\t\t\t\t\t\ttitle:\"评论成功\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tcomment_bottom_val.value=\"\"\r\n\t\t\t\t\t\tfetchComments()\r\n\t\t\t\t\t}\r\n\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('添加评论失败:', error);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.log('请先登录或填写回复内容');\r\n\t\t}\r\n\t}\r\n\r\n\t// 展开/收起回复\r\n\tfunction toggleReplies(comment) {\r\n\t\tcomment.showReplies = !comment.showReplies;\r\n\t}\r\n\r\n\tonMounted(() => {\r\n\t\tfetchComments()\r\n\t\t// fetchUser();\r\n\t\t// fetchComments();\r\n\t});\r\n</script>\r\n\r\n<style scoped>\n\tbody {\n\t\tfont-family: 'Roboto', sans-serif;\n\t\tbackground-color: #f4f7fc;\n\t}\n\n\t.container {\n\t\tmax-width: 900px;\n\t\tmargin: auto;\n\t\tpadding: 2rem;\n\t}\n\n\t.comment-section {\n\t\tbackground-color: #ffffff;\n\t\tborder-radius: 8px;\n\t\tbox-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n\t\tpadding: 2rem;\n\t}\n\n\t.comment-item {\n\t\tborder-bottom: 1px solid #eaeaea;\n\t\tpadding: 1rem 0;\n\t}\n\n\t.comment-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t}\n\n\t.comment-author {\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t\tfont-size: 1.1rem;\n\t}\n\n\t.comment-time {\n\t\tcolor: #777;\n\t\tfont-size: 0.9rem;\n\t}\n\n\t.toggle-replies-button {\n\t\tbackground-color: transparent;\n\t\tborder: none;\n\t\tcolor: #007bff;\n\t\tcursor: pointer;\n\t\tfont-size: 0.9rem;\n\t}\n\n\t.toggle-replies-button:hover {\n\t\ttext-decoration: underline;\n\t}\n\n\t.comment-content {\n\t\tmargin-top: 0.5rem;\n\t\tline-height: 1.6;\n\t\tcolor: #555;\n\t\tfont-size: 1rem;\n\t}\n\n\t.replies {\n\t\tmargin-top: 1rem;\n\t\tpadding-left: 1rem;\n\t\tborder-left: 2px solid #ddd;\n\t}\n\n\t.comment-reply {\n\t\tmargin-bottom: 1rem;\n\t}\n\n\t.reply-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t}\n\n\t.input-field {\n\t\twidth: 100%;\n\t\theight: 40px;\n\t\tmargin-bottom: 1rem;\n\t\tpadding: 0.5rem;\n\t\tborder: 1px solid #ccc;\n\t\tborder-radius: 6px;\n\t\ttransition: border-color 0.3s ease;\n\t\tfont-size: 1rem;\n\t}\n\n\t.input-field:focus {\n\t\toutline: none;\n\t\tborder-color: #007bff;\n\t}\n\n\t.submit-button {\n\t\tbackground-color: #007bff;\n\t\tcolor: white;\n\t\tborder: none;\n\t\tpadding: 0.75rem 1.5rem;\n\t\tborder-radius: 6px;\n\t\tcursor: pointer;\n\t\ttransition: background-color 0.3s ease;\n\t\tfont-size: 1rem;\n\t}\n\n\t.submit-button:hover {\n\t\tbackground-color: #0056b3;\n\t}\n\n\t.bottom-ipt {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tpadding: 10px;\n\t\tbackground-color: #fff;\n\t\tbox-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);\n\t}\n\n\t.bottom-ipt input {\n\t\twidth: 80%;\n\t\tborder-radius: 4px;\n\t\tborder: 1px solid #ccc;\n\t\tpadding: 10px;\n\t\tfont-size: 1rem;\n\t}\n\n\t.bottom-ipt button {\n\t\twidth: 18%;\n\t\tborder-radius: 4px;\n\t\tborder: none;\n\t\tbackground-color: #007bff;\n\t\tcolor: white;\n\t\tpadding: 10px;\n\t\tfont-size: 1rem;\n\t\tcursor: pointer;\n\t}\n\n\t.bottom-ipt button:hover {\n\t\tbackground-color: #0056b3;\n\t}\n\n\t.delete-icon {\n\t\tcursor: pointer;\n\t\tcolor: #d9534f;\n\t}\n\n\t.delete-icon:hover {\n\t\tcolor: #c9302c;\n\t}\n\n\t.fade-enter-active,\n\t.fade-leave-active {\n\t\ttransition: opacity 0.5s;\n\t}\n\n\t.fade-enter, .fade-leave-to {\n\t\topacity: 0;\n\t}\n</style>","import MiniProgramPage from 'E:/uniapp工作空间/Science _fiction/pages/discussion/discussion.vue'\nwx.createPage(MiniProgramPage)"],"names":["user","uni","comments","ref","comment_val","comment_bottom_val","gettime","date","year","month","day","hours","minutes","seconds","deleteCommentStart","Discussion_ID","res","deletecomment","response3","Delete_Discussion","fetchComments","error","response","Get_Discussion","addReply","comment","Add_Discussion","addReply_bottom","toggleReplies","onMounted","MiniProgramPage"],"mappings":"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"}