"use strict";const e=require("../../common/vendor.js"),n=require("../../api.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const a={__name:"profile",setup(a){let t=JSON.parse(e.index.getStorageSync("userInfo")),u=e.ref(t.nickname),o=e.ref(t.email),i=e.ref(""),r=e.ref(""),s=e.ref(""),l=e.ref("true"),f=t.username,d=e.ref(!0),c=e.ref(!0);function v(){l.value=!1}async function h(){l.value=!0;try{if(200==(await e.index.request({url:n.Change_Userinfo,method:"POST",data:{username:f,new_nickname:u.value,new_email:o.value}})).statusCode){e.index.showToast({title:"修改成功",icon:"success",duration:2e3});const a=await e.index.request({url:n.Get_Userinfo,method:"GET",header:{Authorization:`Bearer ${e.index.getStorageSync("token")}`}});e.index.setStorageSync("userInfo",JSON.stringify(a.data.userInfo)),console.log(a)}}catch{console.log("请求失败")}}function p(){l.value=!0,u.value=t.nickname,o.value=t.email}async function w(){if(r.value===s.value)try{const a=await e.index.request({url:n.Change_Password,method:"POST",data:{username:f,old_password:i.value,new_password:r.value},header:{Authorization:`Bearer ${e.index.getStorageSync("token")}`}});console.log(a),200==a.statusCode?(e.index.showToast({title:"密码修改成功",icon:"success",duration:2e3}),i.value="",r.value="",s.value=""):e.index.showToast({title:"原密码错误",icon:"none",duration:2e3})}catch{e.index.showToast({title:"请求失败，请稍后再试",icon:"none",duration:2e3})}else e.index.showToast({title:"新密码与确认密码不一致",icon:"none",duration:2e3})}function m(){d.value=!d.value}function g(){c.value=!c.value}return(n,a)=>e.e({a:e.unref(d)},e.unref(d)?{b:e.p({type:"down",size:"30"})}:{c:e.p({type:"up",size:"30"})},{d:e.t(e.unref(d)?"修改个人信息":"个人信息："),e:e.o(m),f:e.unref(l),g:e.unref(u),h:e.o((n=>e.isRef(u)?u.value=n.detail.value:u=n.detail.value)),i:e.unref(l),j:e.unref(o),k:e.o((n=>e.isRef(o)?o.value=n.detail.value:o=n.detail.value)),l:e.unref(l)},e.unref(l)?{m:e.o(v)}:{n:e.o(h),o:e.o(p)},{p:!e.unref(d),q:e.unref(c)},e.unref(c)?{r:e.p({type:"down",size:"30"})}:{s:e.p({type:"up",size:"30"})},{t:e.t(e.unref(c)?"修改密码":"修改密码："),v:e.o(g),w:e.unref(i),x:e.o((n=>e.isRef(i)?i.value=n.detail.value:i=n.detail.value)),y:e.unref(r),z:e.o((n=>e.isRef(r)?r.value=n.detail.value:r=n.detail.value)),A:e.unref(s),B:e.o((n=>e.isRef(s)?s.value=n.detail.value:s=n.detail.value)),C:!e.unref(c),D:e.o(w),E:!e.unref(c)})}};wx.createPage(a);
