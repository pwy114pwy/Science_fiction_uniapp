"use strict";const e=require("../../common/vendor.js"),o=require("../../api.js"),t={__name:"history",setup(t){const a=e.ref(!0),s=e.ref([]),n=JSON.parse(e.index.getStorageSync("userInfo")),i=async()=>{try{const t=await e.index.request({url:o.Clear_AllBrowseHistory,method:"POST",data:{User_Name:n.username}});console.log(t),200==t.statusCode?(e.index.showToast({title:"清空记录成功",icon:"success"}),s.value=[]):e.index.showToast({title:"清空记录失败，请稍后再试",icon:"none"})}catch(t){e.index.showToast({title:"网络请求失败，请检查您的网络连接",icon:"none"})}};return e.onMounted((()=>{(async()=>{try{const t=await e.index.request({url:o.Get_All_BrowseHistory,method:"POST",data:{User_Name:n.username}});s.value=t.data,console.log(s.value)}catch(t){e.index.showToast({title:"加载失败，请稍后再试",icon:"none"})}finally{a.value=!1}})()})),(t,r)=>e.e({a:a.value},a.value||0===s.value.length?{}:{c:e.o(i),d:e.f(s.value,((t,a,i)=>({a:t.Img_Url,b:e.o((o=>{return a=t.Book_ID,void e.index.navigateTo({url:`/pages/detail/detail?id=${a}`});var a}),t.Book_ID),c:e.t(t.Book_Name),d:e.t(t.Browse_Time),e:e.o((a=>(async t=>{try{const a=await e.index.request({url:o.Delete_BrowseHistory,method:"POST",data:{User_Name:n.username,Book_ID:t}});console.log(a),200==a.statusCode?(e.index.showToast({title:"删除记录成功",icon:"success"}),s.value=s.value.filter((e=>e.Book_ID!==t))):e.index.showToast({title:"删除记录失败，请稍后再试",icon:"none"})}catch(a){e.index.showToast({title:"网络请求失败，请检查您的网络连接",icon:"none"})}})(t.Book_ID)),t.Book_ID),f:t.Book_ID})))},{b:0===s.value.length})}},a=e._export_sfc(t,[["__scopeId","data-v-82a842cc"]]);wx.createPage(a);
